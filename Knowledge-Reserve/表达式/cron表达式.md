# [`cron表达式`](/)

![](./__assets__/cron表达式-2024-03-15-10-20-54.png)

- CRON表达式是一个字符串，包含五个到七个由空格分隔的字段（每种软件不一样），表示一组时间，通常作为执行某个程序的时间表
- 注释以注释标记#开始，并且必须单独在一行上
- 类型:
  - `Linux`
  - `Java(Spring)`
  - `Java(Quartz)`

```js
Linux
# 每月的最后1天
0 0 L * * *

说明：
Linux
*    *    *    *    *
-    -    -    -    -
|    |    |    |    |
|    |    |    |    +----- day of week (0 - 7) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
|    |    |    +---------- month (1 - 12) OR jan,feb,mar,apr ...
|    |    +--------------- day of month (1 - 31)
|    +-------------------- hour (0 - 23)
+------------------------- minute (0 - 59)
```

```js
Java(Spring)
*    *    *    *    *    *
-    -    -    -    -    -
|    |    |    |    |    |
|    |    |    |    |    +----- day of week (0 - 7) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
|    |    |    |    +---------- month (1 - 12) OR jan,feb,mar,apr ...
|    |    |    +--------------- day of month (1 - 31)
|    |    +-------------------- hour (0 - 23)
|    +------------------------- min (0 - 59)
+------------------------------ second (0 - 59)
```

```js
Java(Quartz)
*    *    *    *    *    *    *
-    -    -    -    -    -    -
|    |    |    |    |    |    |
|    |    |    |    |    |    + year [optional]
|    |    |    |    |    +----- day of week (1 - 7) sun,mon,tue,wed,thu,fri,sat
|    |    |    |    +---------- month (1 - 12) OR jan,feb,mar,apr ...
|    |    |    +--------------- day of month (1 - 31)
|    |    +-------------------- hour (0 - 23)
|    +------------------------- min (0 - 59)
+------------------------------ second (0 - 59)
```

| 字段         | 是否必填 | 允许值          | 允许特殊字符 | 备注                                                                                                 |
| :----------- | :------- | :-------------- | :----------- | :--------------------------------------------------------------------------------------------------- |
| Seconds      | 是       | 0–59            | `*,-`        | 标准实现不支持此字段。                                                                               |
| Minutes      | 是       | 0–59            | `*,-`        |
| Hours        | 是       | 0–23            | `*,-`        |
| Day of month | 是       | 1–31            | `*,-?LW`     | `?LW` 只有部分软件实现了                                                                             |
| Month        | 是       | 1–12 or JAN–DEC | `*,-`        |
| Day of week  | 是       | 0–7 or SUN–SAT  | `*,-?L#`     | `?L#`只有部分软件实现<br/> Linux和Spring的允许值为0-7，0和7为周日 <br/> Quartz的允许值为1-7，1为周日 |
| Year         | 否       | 1970–2099       | `*,-`        | 标准实现不支持此字段。                                                                               |

## 标准字段

- 逗号用于分隔列表。例如，在第5个字段(星期几)中使用 MON,WED,FRI 表示周一、周三和周五。

- 连字符定义范围。例如，2000-2010 表示2000年至2010年期间的每年，包括2000年和2010年。

- 除非用反斜杠`\`转义，否则命令中的百分号(%)会被替换成换行符，第一个百分号后面的所有数据都会作为标准输入发送给命令。

## 非标准字段

- “L”代表“Last”。

  - 当在星期几字段中使用的时候，可以指定给定月份的结构，例如“最后一个星期五”(`5L`)
  - 在月日字段中，可以指定一个月的最后一天

- “day of month”字段可以使用“W”字符。指定最接近给定日期的工作日（星期一-星期五）。

  - 例如，`15W`，意思是：“最接近该月15日的工作日。”；所以，如果15号是星期六，触发器在14号星期五触发。如果15日是星期天，触发器在1日星期一触发。如果15号是星期二，那么它在15号星期二触发
  - `1W`，如果这个月的第一天是星期六，不会跨到上个月，触发器会在这个月的第三天（也就是星期一）触发。只有指定一天（不能是范围或列表）的时候，才能指定“W”字符

- 星期几字段可以使用“#”，后面必须跟一个介于1和5之间的数字。例如，5#3表示每个月的第三个星期五

- 在某些实现中，“?”用来代替“_”以将月中的某一天或周中的某一天留空。其他cron的实现是替换“?”为cron守护进程的启动时间，例如：`？？_ \* \* _`，如果cron在上午8:25启动，将更新为`25 8 _ \* \* \*`并在每天的这个时间运行，直到再次重新启动

- 分钟字段设置 `*/5` 表示每5分钟一次，注意：这里指的是能被5整除的分钟数

## 常用

> `- * / ?`

- `*`：每的意思。在不同的字段上，就代表每秒，每分，每小时等。
- `-`：指定值的范围。比如[1-10]，在秒字段里就是每分钟的第1到10秒，在分就是每小时的第1到10分钟，以此类推。
- `,`：指定某几个值。比如[2,4,5]，在秒字段里就是每分钟的第2，第4，第5秒，以此类推。
- `/`：指定值的起始和增加幅度。比如[3/5]，在秒字段就是每分钟的第3秒开始，每隔5秒生效一次，也就是第3秒、8秒、13秒，以此类推
- `?`：仅用于【日】和【周】字段。因为在指定某日和周几的时候，这两个值实际上是冲突的，所以需要用【?】标识不生效的字段。比如`0 1 * * * ?`就代表每年每月每日每小时的1分0秒触发任务。这里的周就没有效果

## 非常用

- SUN：仅用于【周】字段，表示星期日。也可以用数字1设置。
  - 周日到周六分别为SUN，MON，TUE，WED，THU，FRI和SAT，对应数字1，2，3，4，5，6，7。目前Quartz支持。
- L：即 last，用于【日】【周】字段。这里需要注意的是，在不同的字段的不同使用方式，其含义有所差别。
  - 用于日字段：直接使用L代表每个月的最后一天。也支持偏移量的方式，配置[L-1]则代表每月的倒数第二天。
  - 用于周字段：直接使用L代表每周的最后一天，也就是等效于[7]或[SAT]，但是如果配合上数字，比如[7L]，则代表每个月最后一个周六，等效于[SATL]。目前Quartz支持。

## 正则校验表达式

```shell
^(\*|[0-9,\-/]+)\s(\*|[0-9,\-/]+)\s(\*|[0-9,\-/]+)\s(\*|[0-9,\-/]+)\s(\*|[0-9,\-/]+)$
```

## Example

| cron表达式                                            | 含义                                                   | 执行时间                                                                                                                                           |
| :---------------------------------------------------- | :----------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| `5 * * * * ?`                                         | 每分钟的第5秒执行一次                                  | 2021-04-11 13:10:05 <br/>2021-04-11 13:11:05 <br/> 2021-04-11 13:12:05 <br/> 2021-04-11 13:13:05<br/> 2021-04-11 13:14:05 <br/>2021-04-11 13:15:05 |
| `5 * 10-22 * * ?`                                     | 从早上10点到晚上十点，每分钟的第5秒执行一次            | 2021-04-11 13:10:05 2021-04-11 13:11:05<br/>2021-04-11 13:12:05<br/>2021-04-11 13:13:05<br/>2021-04-11 13:14:05<br/>2021-04-11 13:15:05            |
| `5 0 0/6 * * ?` <br/>等效于<br/>`5 0 0,6,12,18 * * ?` | 每天从0点开始，每隔6小时执行一次。执行时间为第0分5秒。 | 2021-04-12 00:00:05 <br/> 2021-04-12 06:00:05<br/>2021-04-12 12:00:05<br/>2021-04-12 18:00:05                                                      |
